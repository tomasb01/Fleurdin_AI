======================================================================
üìä FLEURDIN AI - RAG PIPELINE STATUS REPORT
======================================================================
Datum: 2025-12-02
Autor: Claude Code + Tom√°≈°
Status: ‚úÖ IMPLEMENTOV√ÅNO, ‚ö†Ô∏è PROBL√âMY S RELEVANC√ç

======================================================================
1. CO JSME UDƒöLALI - KOMPLETN√ç PIPELINE
======================================================================

üìÇ KROK 1: PARSING (parsing_script.py)
----------------------------------------------------------------------
‚úÖ Naƒçten√≠ zdrojov√Ωch soubor≈Ø:
  ‚Ä¢ Excel: 30 esenci√°ln√≠ch olej≈Ø
  ‚Ä¢ Word: 2 knihy o bylink√°ch (1,590 + 1,877 odstavc≈Ø)
  ‚Ä¢ Word: 1 voice transkript (DRIENKY, 3 odstavce)

‚úÖ V√Ωstup: parsed_data.json (3,500 polo≈æek)


üß© KROK 2: CHUNKING (chunking_script.py)
----------------------------------------------------------------------
‚úÖ Strategie:
  ‚Ä¢ Mal√© texty (<1,500 znak≈Ø) = ponechat cel√©
  ‚Ä¢ Velk√© texty = rozdƒõlit na 1,200 znak≈Ø s 200 p≈ôekryvem (17%)

‚úÖ Parametry:
  ‚Ä¢ chunk_size: 1,200 znak≈Ø (optimalizov√°no pro GPT-4-mini n√°klady)
  ‚Ä¢ overlap: 200 znak≈Ø
  ‚Ä¢ D≈Øvod: Kompromis mezi kvalitou a cenou (+$0.14/mƒõs√≠c vs 1,000 znak≈Ø)

‚úÖ V√Ωstup: chunked_data.json (3,505 chunk≈Ø)


üè∑Ô∏è KROK 3: FIX LABELS (fix_labels_script.py)
----------------------------------------------------------------------
‚úÖ Probl√©m: P≈Øvodn√≠ labels byly nejasn√© (98.9% "book_paragraph")
‚úÖ ≈òe≈°en√≠: Vytvo≈ôen label mapping:

  P≈òED:                          PO OPRAVƒö:
  ‚Ä¢ book_paragraph        ‚Üí      ‚Ä¢ herb_knowledge
  ‚Ä¢ voice_transcript      ‚Üí      ‚Ä¢ herb_knowledge
  ‚Ä¢ essential_oil         ‚Üí      ‚Ä¢ essential_oil (beze zmƒõny)

‚úÖ Fin√°ln√≠ struktura ka≈æd√©ho chunku:
  {
    "id": "oil_16_full",
    "type": "essential_oil",           // Hlavn√≠ kategorie
    "entity_type": "oil_profile",      // Podkategorie
    "content_type": "database",        // Typ obsahu
    "tier": "free",                    // Business model (free/premium)
    "name": "Levandule",               // N√°zev entity
    "text": "OLEJ: Levandule...",
    "part": 1,
    "total_parts": 1,
    "chunk_size": 970,
    "embedding": [0.23, -0.45, ...],   // 384 dimenz√≠
    "metadata": {
      "english_name": "Lavender",
      "latin_name": "Lavandula",
      "category": "esenci√°ln√≠ oleje"
    }
  }

‚úÖ Rozdƒõlen√≠:
  ‚Ä¢ essential_oil: 30 chunk≈Ø (tier: free)
  ‚Ä¢ herb_knowledge: 3,475 chunk≈Ø (tier: premium)
  ‚Ä¢ CELKEM: 3,505 chunk≈Ø

‚úÖ V√Ωstup: chunked_data_FIXED.json (39.5 MB)


üß† KROK 4: EMBEDDINGS (embeddings_script.py)
----------------------------------------------------------------------
‚úÖ Model: paraphrase-multilingual-MiniLM-L12-v2
  ‚Ä¢ Dimenze: 384
  ‚Ä¢ Max tokens: 512 (~2,048 znak≈Ø)
  ‚Ä¢ Jazyky: ƒåe≈°tina + Sloven≈°tina
  ‚Ä¢ Velikost: ~420 MB
  ‚Ä¢ Open-source: Zdarma

‚úÖ Proces:
  ‚Ä¢ Batch size: 32
  ‚Ä¢ Vytvo≈ôen√≠ embeddings pro v≈°ech 3,505 chunk≈Ø
  ‚Ä¢ Ka≈æd√Ω chunk dostal 384-dimenzion√°ln√≠ vektor

‚úÖ V√Ωstup: chunked_data_with_embeddings.json (39.5 MB)


üíæ KROK 5: SUPABASE UPLOAD (upload_to_supabase.py)
----------------------------------------------------------------------
‚úÖ Datab√°ze: Supabase (PostgreSQL + pgvector extension)
‚úÖ Tabulka: knowledge_chunks

‚úÖ SQL Schema:
  ‚Ä¢ Sloupce: id, type, entity_type, content_type, tier, name, text,
             part, total_parts, chunk_size, metadata, embedding (vector 384)
  ‚Ä¢ Indexy: type, tier, entity_type
  ‚Ä¢ Vector index: ivfflat (lists=100) pro rychl√© vyhled√°v√°n√≠

‚úÖ RPC Funkce: match_chunks()
  ‚Ä¢ Parametry: query_embedding, match_threshold, match_count,
               filter_tier, filter_type
  ‚Ä¢ Vrac√≠: Top N nejpodobnƒõj≈°√≠ch chunk≈Ø s similarity score (0-1)
  ‚Ä¢ Podporuje filtrov√°n√≠ podle tier (free/premium) a type

‚úÖ Upload:
  ‚Ä¢ Batch processing: 100 chunk≈Ø najednou
  ‚Ä¢ Celkov√° doba: ~13 sekund
  ‚Ä¢ Status: 3,505/3,505 chunk≈Ø √∫spƒõ≈°nƒõ nahr√°no ‚úÖ


üîç KROK 6: TESTOV√ÅN√ç (test_vector_search.py)
----------------------------------------------------------------------
‚úÖ Testy vector search provedeny
‚úÖ Statistiky datab√°ze ovƒõ≈ôeny
‚úÖ Tier filtering funguje
‚úÖ Type filtering funguje


======================================================================
2. AKTU√ÅLN√ç V√ùSLEDKY TEST≈Æ
======================================================================

TEST 1: "Jak pou≈æ√≠t levanduli na span√≠?" (filter: essential_oil)
----------------------------------------------------------------------
Oƒçek√°van√Ω v√Ωsledek: Levandule by mƒõla b√Ωt #1
Skuteƒçn√Ω v√Ωsledek:

  Top 5 v√Ωsledk≈Ø:
  1. Frangipani          | Similarity: 0.440 | ‚úÖ Sedativum
  2. Bazalka             | Similarity: 0.388 | ‚ùì
  3. Ho wood             | Similarity: 0.377 | ‚úÖ Sedativum
  4. Borovice lesn√≠      | Similarity: 0.365 | ‚ùì
  5. Mu≈°k√°tov√Ω o≈ô√≠≈°ek    | Similarity: 0.352 | ‚ùì

  ‚ùå Levandule: pozice 9/30 | Similarity: 0.333

‚ùå PROBL√âM: Levandule nen√≠ v top 5, p≈ôesto≈æe m√° v textu:
   "Podporuje sp√°nek a ulevuje p≈ôi nespavosti"


TEST 2: "Jak√© jsou l√©ƒçiv√© √∫ƒçinky p√∫pavy?" (filter: herb_knowledge)
----------------------------------------------------------------------
Oƒçek√°van√Ω v√Ωsledek: Nƒõkolik chunk≈Ø o p√∫pavƒõ
Skuteƒçn√Ω v√Ωsledek:

  ‚úÖ 1 v√Ωsledek nalezen:
  1. Kniha 1 - odstavec 2316 | Similarity: 0.458

‚ö†Ô∏è  PROBL√âM: Pouze 1 v√Ωsledek - mo≈æn√° je p√∫pava v dal≈°√≠ch chunkc√≠ch


TEST 3: "Bolest hlavy" (filter: free tier only)
----------------------------------------------------------------------
Oƒçek√°van√Ω v√Ωsledek: Oleje pom√°haj√≠c√≠ s bolest√≠ hlavy
Skuteƒçn√Ω v√Ωsledek:

  Top 4 v√Ωsledk≈Ø:
  1. Smrk ƒçern√Ω         | Similarity: 0.360
  2. ≈òeb≈ô√≠ƒçek           | Similarity: 0.335
  3. Mu≈°k√°tov√Ω o≈ô√≠≈°ek   | Similarity: 0.309
  4. R≈Ø≈æe               | Similarity: 0.302

  ‚ùå Levandule NE v top 5 (p≈ôesto≈æe m√° "Zm√≠r≈àuje bolesti hlavy")

‚úÖ FUNGUJE: Tier filtering (pouze free oleje)


TEST 4: "Drienka na zdrav√≠" (bez filtr≈Ø)
----------------------------------------------------------------------
Oƒçek√°van√Ω v√Ωsledek: Chunky o ≈°√≠pk√°ch/drience
Skuteƒçn√Ω v√Ωsledek:

  Top 5 v√Ωsledk≈Ø:
  1. Kniha 2 - odstavec 67    | Similarity: 0.853 | "≈†√≠pkov√Ω pr√°≈°ok zdravia"
  2. Kniha 2 - odstavec 1052  | Similarity: 0.827 | "≈†√çPKOV√ù PR√Å≈†OK ZDRAVIA"
  3. Kniha 2 - odstavec 597   | Similarity: 0.825 | "ZDRAV√â LESN√â MUFFINY"
  4. Kniha 2 - odstavec 1191  | Similarity: 0.699 | "ORGOV√ÅNOV√ù MED"
  5. Kniha 2 - odstavec 1525  | Similarity: 0.669 | O b≈ô√≠ze

‚úÖ FUNGUJE PERFEKTNƒö: Velmi vysok√° similarity (0.8+)


======================================================================
3. IDENTIFIKOVAN√â PROBL√âMY
======================================================================

‚ùå PROBL√âM #1: RELEVANTN√ç INFO "UTONUT√â" V TEXTU
----------------------------------------------------------------------
Popis:
  ‚Ä¢ Levandule m√° 970 znak≈Ø textu
  ‚Ä¢ Obsahuje 15+ r≈Øzn√Ωch kategori√≠ (k≈Ø≈æe, vlasy, tr√°ven√≠, svaly,
    bolest, srdce, hormony, imunita, nervov√Ω syst√©m, psychika)
  ‚Ä¢ Info o span√≠ je pouze ~50 znak≈Ø z 970 (5% textu)

D≈Øsledek:
  ‚Ä¢ Embedding vektor reprezentuje PR≈ÆMƒöR v≈°ech tƒõch t√©mat
  ‚Ä¢ Span√≠ m√° malou v√°hu ‚Üí n√≠zk√° similarity pro dotazy o span√≠
  ‚Ä¢ Model vid√≠ Levanduli jako "multi-purpose" olej, ne prim√°rnƒõ
    na span√≠

P≈ô√≠klad Levandule textu:
  "...Na ekz√©m, Lup√©nku, Akn√©, Jizvy, Strie, Bodnut√≠ hmyzem,
   Hoj√≠ pop√°leniny, Podporuje r≈Øst vlas≈Ø, Ulevuje od svƒõdƒõn√≠
   poko≈æky hlavy, Pom√°h√° proti lup≈Øm, Pom√°h√° p≈ôi cukrovce,
   Na bolav√© svaly a klouby, P≈ôi revmatismu, Zm√≠r≈àuje bolesti
   hlavy a ucha, Sni≈æuje krevn√≠ tlak, Sni≈æuje hladinu cholesterolu,
   Ulevuje p≈ôi PMS, Pom√°h√° p≈ôi alergi√≠ch, Pom√°h√° p≈ôi Alzheimerovƒõ
   chorobƒõ, Uklid≈àuje p≈ôet√≠≈æen√© nervy, Uvol≈àuje napƒõt√≠, Pom√°h√°
   p≈ôi vertigu, Na √∫≈æeh, Uklid≈àuje mysl, Pom√°h√° p≈ôi stresu
   a depres√≠ch, Zlep≈°uje n√°ladu, Podporuje sp√°nek a ulevuje
   p≈ôi nespavosti..."

‚Üí "Podporuje sp√°nek" je ztraceno mezi 20+ dal≈°√≠mi √∫ƒçinky


‚ùå PROBL√âM #2: MAL√ù POƒåET V√ùSLEDK≈Æ PRO SPECIFICK√â DOTAZY
----------------------------------------------------------------------
Popis:
  ‚Ä¢ Dotaz "p√∫pava" vr√°til pouze 1 chunk
  ‚Ä¢ Mo≈æn√° existuje v√≠c chunk≈Ø o p√∫pavƒõ, ale maj√≠ similarity <0.3

D≈Øsledek:
  ‚Ä¢ U≈æivatel nevid√≠ v≈°echny relevantn√≠ informace
  ‚Ä¢ RAG m≈Ø≈æe b√Ωt ne√∫pln√Ω


‚ùå PROBL√âM #3: THRESHOLD 0.3 MO≈ΩN√Å M√ìC P≈ò√çSNN√ù
----------------------------------------------------------------------
Souƒçasn√© nastaven√≠:
  ‚Ä¢ match_threshold = 0.3
  ‚Ä¢ match_count = 5

D≈Øsledek:
  ‚Ä¢ Odfiltruje chunky se similarity 0.25-0.30 (kter√© mohou b√Ωt
    relevantn√≠)


======================================================================
4. MO≈ΩN√Å ≈òE≈†EN√ç (K DISKUZI)
======================================================================

üí° ≈òE≈†EN√ç A: METADATA TAGS + HYBRID SEARCH
----------------------------------------------------------------------
Co to je:
  ‚Ä¢ P≈ôidat do metadata tags pro ka≈æd√Ω olej:

    "metadata": {
      "tags": ["span√≠", "nespavost", "relaxace", "stres",
               "bolest_hlavy", "akn√©", "pop√°leniny", ...],
      "categories": {
        "psychika": true,
        "k≈Ø≈æe": true,
        "bolest": true
      }
    }

  ‚Ä¢ Upravit RAG pipeline:
    1. Vector search (top 20)
    2. Re-rank podle metadata (boost +0.2 pro relevantn√≠ tags)
    3. Vr√°tit top 5

V√Ωhody:
  ‚úÖ Levandule by dostala bonus za tag "span√≠" ‚Üí top v√Ωsledek
  ‚úÖ P≈ôesnost + s√©mantick√© porozumƒõn√≠
  ‚úÖ ≈Ω√°dn√© re-chunkov√°n√≠ (rychl√° implementace)

Nev√Ωhody:
  ‚ùå Manu√°ln√≠ pr√°ce s tagy (nebo AI extrakce)
  ‚ùå Nutnost aktualizovat v≈°ech 30 olej≈Ø


üí° ≈òE≈†EN√ç B: RE-CHUNKING (MEN≈†√ç CHUNKY)
----------------------------------------------------------------------
Co to je:
  ‚Ä¢ Rozdƒõlit ka≈æd√Ω olej na men≈°√≠ chunky podle kategori√≠:
    - Chunk 1: "Levandule - √öƒçinky na k≈Ø≈æi" (200 znak≈Ø)
    - Chunk 2: "Levandule - √öƒçinky na psychiku" (150 znak≈Ø)
    - Chunk 3: "Levandule - Bolest a z√°nƒõty" (180 znak≈Ø)
    - atd.

V√Ωhody:
  ‚úÖ Embeddings budou zamƒõ≈ôen√© na konkr√©tn√≠ t√©ma
  ‚úÖ "Span√≠" chunk bude m√≠t vysokou similarity
  ‚úÖ ≈Ω√°dn√© metadata tags pot≈ôeba

Nev√Ωhody:
  ‚ùå V√≠ce chunk≈Ø = vy≈°≈°√≠ n√°klady (GPT-4-mini input)
  ‚ùå Nutnost re-chunkovat v≈°echna data
  ‚ùå Ztr√°ta kontextu (u≈æivatel nevid√≠ v≈°echny √∫ƒçinky najednou)


üí° ≈òE≈†EN√ç C: ZV√ù≈†IT MATCH_COUNT A SN√ç≈ΩIT THRESHOLD
----------------------------------------------------------------------
Co to je:
  ‚Ä¢ match_count: 5 ‚Üí 10
  ‚Ä¢ match_threshold: 0.3 ‚Üí 0.25

V√Ωhody:
  ‚úÖ Nejjednodu≈°≈°√≠ (zmƒõna 2 ƒç√≠sel)
  ‚úÖ Levandule by se zobrazila (je na pozici 9)
  ‚úÖ V√≠ce v√Ωsledk≈Ø = v√≠c info pro u≈æivatele

Nev√Ωhody:
  ‚ùå Ne≈ôe≈°√≠ core probl√©m (Levandule m√° n√≠zkou similarity)
  ‚ùå Vy≈°≈°√≠ n√°klady (10 chunk≈Ø m√≠sto 5 ‚Üí +100% input tokens)
  ‚ùå Mo≈æn√° irelevantn√≠ v√Ωsledky (similarity <0.3)


üí° ≈òE≈†EN√ç D: KOMBINACE A + C (DOPORUƒåENO)
----------------------------------------------------------------------
Co to je:
  1. P≈ôidat metadata tags (≈òe≈°en√≠ A)
  2. Zv√Ω≈°it match_count na 10 (≈òe≈°en√≠ C)
  3. Re-rank podle tags + similarity
  4. Vr√°tit top 5 s nejvy≈°≈°√≠m sk√≥re

V√Ωhody:
  ‚úÖ Nejlep≈°√≠ ze v≈°ech svƒõt≈Ø
  ‚úÖ P≈ôesnost + v√≠c kandid√°t≈Ø
  ‚úÖ Rozumn√© n√°klady

Nev√Ωhody:
  ‚ùå Manu√°ln√≠ pr√°ce s tagy


üí° ≈òE≈†EN√ç E: KEYWORD EXTRACTION + METADATA
----------------------------------------------------------------------
Co to je:
  ‚Ä¢ AI automaticky extrahuje kl√≠ƒçov√° slova z textu:

    from sklearn.feature_extraction.text import TfidfVectorizer

    keywords = extract_keywords(oil_text)
    # ‚Üí ["span√≠", "nespavost", "relaxace", "stres", ...]

  ‚Ä¢ Ulo≈æ√≠ do metadata.tags
  ‚Ä¢ ≈Ω√°dn√° manu√°ln√≠ pr√°ce

V√Ωhody:
  ‚úÖ Automatizovan√© (0 manu√°ln√≠ pr√°ce)
  ‚úÖ ≈†k√°lovateln√© (funguje pro 100+ olej≈Ø)

Nev√Ωhody:
  ‚ùå Mo≈æn√° nep≈ôesn√© (AI chyby)
  ‚ùå Nutnost ovƒõ≈ôen√≠


======================================================================
5. STATISTIKY & SHRNUT√ç
======================================================================

‚úÖ CO FUNGUJE:
----------------------------------------------------------------------
  ‚Ä¢ Parsing: 100% √∫spƒõ≈°nost
  ‚Ä¢ Chunking: 3,505 chunk≈Ø vytvo≈ôeno
  ‚Ä¢ Embeddings: V≈°echny vektory vytvo≈ôeny (384 dimenz√≠)
  ‚Ä¢ Supabase upload: 3,505/3,505 chunk≈Ø (100%)
  ‚Ä¢ Tier filtering: Funguje perfektnƒõ (free vs premium)
  ‚Ä¢ Type filtering: Funguje perfektnƒõ (essential_oil vs herb_knowledge)
  ‚Ä¢ Labels: Spr√°vnƒõ implementov√°ny a opraveny
  ‚Ä¢ Vector search: Technicky funkƒçn√≠
  ‚Ä¢ Vysok√° similarity pro p≈ôesn√© dotazy: "Drienka" ‚Üí 0.853 ‚úÖ


‚ö†Ô∏è  CO NEFUNGUJE OPTIM√ÅLNƒö:
----------------------------------------------------------------------
  ‚Ä¢ Relevance pro multi-purpose entity (Levandule): Pozice 9/30 ‚ùå
  ‚Ä¢ Mal√Ω poƒçet v√Ωsledk≈Ø pro nƒõkter√© dotazy: P√∫pava ‚Üí pouze 1 ‚ùå
  ‚Ä¢ Specifick√© √∫ƒçinky "utonut√©" v dlouh√Ωch textech ‚ùå
  ‚Ä¢ Threshold mo≈æn√° moc p≈ô√≠sn√Ω (0.3) ‚ö†Ô∏è


üìä DATAB√ÅZE:
----------------------------------------------------------------------
  ‚Ä¢ Celkem chunk≈Ø: 3,505
  ‚Ä¢ Essential oils (free): 30
  ‚Ä¢ Herb knowledge (premium): 3,475
  ‚Ä¢ Embedding dimenze: 384
  ‚Ä¢ Model: paraphrase-multilingual-MiniLM-L12-v2
  ‚Ä¢ Pr≈Ømƒõrn√° velikost chunku: ~1,050 znak≈Ø


======================================================================
6. DOPORUƒåEN√ç PRO DISKUZI
======================================================================

üéØ OT√ÅZKY K ROZMY≈†LEN√ç:
----------------------------------------------------------------------
1. Jak√Ω je hlavn√≠ use case?
   ‚Ä¢ P≈ôesn√© hled√°n√≠ konkr√©tn√≠ho oleje? ‚Üí Metadata tags
   ‚Ä¢ Objevov√°n√≠ podobn√Ωch olej≈Ø? ‚Üí Souƒçasn√Ω syst√©m OK
   ‚Ä¢ Oboj√≠? ‚Üí Hybrid

2. Kolik ƒçasu m√°me na implementaci?
   ‚Ä¢ Rychl√©: Zv√Ω≈°it match_count (5 min)
   ‚Ä¢ St≈ôedn√≠: Metadata tags (2-4 hodiny pro 30 olej≈Ø)
   ‚Ä¢ Dlouh√©: Re-chunking (1 den)

3. Jak√Ω je budget na OpenAI API?
   ‚Ä¢ N√≠zk√Ω: Nechat match_count=5
   ‚Ä¢ St≈ôedn√≠: Zv√Ω≈°it na 8-10
   ‚Ä¢ Vysok√Ω: Re-chunking (v√≠ce chunk≈Ø)

4. Jak ƒçasto se budou p≈ôid√°vat nov√© oleje?
   ‚Ä¢ Z≈ô√≠dka: Manu√°ln√≠ tagging OK
   ‚Ä¢ ƒåasto: Automatizovan√° extrakce nutn√°


üöÄ NEXT STEPS (po diskuzi):
----------------------------------------------------------------------
1. Rozhodnout, kter√© ≈ôe≈°en√≠ implementovat (A/B/C/D/E)
2. Otestovat na p√°r olej√≠ch (proof of concept)
3. Pokud funguje ‚Üí aplikovat na v≈°ech 30 olej≈Ø
4. Re-test vector search
5. Integrace do chatbota (GPT-4-mini)


======================================================================
üìû KONTAKT & POZN√ÅMKY
======================================================================

Projekt: Fleurdin AI
Datum: 2025-12-02
Status: Pipeline funkƒçn√≠, optimalizace pot≈ôebn√°

D≈Øle≈æit√© soubory:
  ‚Ä¢ chunked_data_FIXED.json (39.5 MB) - Fin√°ln√≠ data
  ‚Ä¢ test_vector_search.py - Test script
  ‚Ä¢ upload_to_supabase.py - Upload script
  ‚Ä¢ RAG_PIPELINE_STATUS_REPORT.txt - Tento dokument

Supabase:
  ‚Ä¢ URL: https://epkdzxknngitpxziylqo.supabase.co
  ‚Ä¢ Tabulka: knowledge_chunks
  ‚Ä¢ RPC funkce: match_chunks()

======================================================================
‚úÖ KONEC REPORTU
======================================================================
